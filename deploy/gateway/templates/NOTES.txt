{{- $secretName := include "gateway.tlsSecretName" . }}
{{- $secretData := (lookup "v1" "Secret" .Release.Namespace $secretName).data }}
{{- $existingAlternativeNamesHash := include "gateway.existingAlternativeNamesHash" . }}
{{- $alternativeNamesHash := include "gateway.alternativeNamesHash" . }}

Admin Console URL - {{ printf "https://%s.%s" .Values.twingate.network (include "gateway.twingate.host" .) }}

{{- if eq "ClusterIP" .Values.service.type }}

1. The Gateway is accessible via its ClusterIP DNS at

{{ printf "%s.%s.svc.%s" (include "gateway.fullname" .) .Release.Namespace .Values.clusterDomain }}

{{- else if eq "LoadBalancer"  .Values.service.type }}

1. The Gateway is accessible via its LoadBalancer IP or hostname. It may take a few minutes for the address to be available.

Watch the LoadBalancer address with: 'kubectl get svc --namespace {{ .Release.Namespace }} -w {{ include "gateway.fullname" . }} -o jsonpath='{.status.loadBalancer.ingress[0]}''

{{- end }}

2. The Gateway uses TLS certificates from the {{ $secretName | quote }} Secret.
{{ if and .Values.tls.autoGenerated.enabled (eq .Values.tls.autoGenerated.engine "cert-manager") }}
Run the following command to get the CA certificate: 'kubectl get secrets {{ include "gateway.fullname" .}}-tls -o jsonpath='{.data.ca\.crt}' | base64 -d'
{{ else }}
The CA certificate is:

{{ if or .Values.tls.existingSecret (eq $existingAlternativeNamesHash $alternativeNamesHash) }}
{{- get $secretData "ca.crt" | b64dec }}
{{- else if .Values.tls.autoGenerated.enabled }}
{{- include "gateway.generateCA" . }}
{{- .Values._generatedCA.Cert }}
{{- else }}
{{- .Values.tls.ca }}
{{- end }}
{{- end }}
