suite: TLS Certificate
templates:
  - cert.yaml
set:
  tls:
    autoGenerated:
      enabled: true
      engine: cert-manager
tests:
  - it: should not render when `autoGenerated` is disabled
    set:
      tls:
        autoGenerated:
          enabled: false
    asserts:
      - hasDocuments:
          count: 0
  - it: should not render when `engine` is helm
    set:
      tls:
        autoGenerated:
          engine: helm
    asserts:
      - hasDocuments:
          count: 0
  - it: should not render when `existingSecret` is provided
    set:
      tls:
        existingSecret: "my-tls-secret"
    asserts:
      - hasDocuments:
          count: 0
  - it: should render
    set:
      twingate:
        resource:
          enabled: true
          extraAnnotations:
            resource.twingate.com/alias: my-alias.int
      tls:
        dnsNames:
          - foo.int
        ipAddresses:
          - 1.1.1.1
    asserts:
      - matchSnapshot: {}
  - it: should set `keyAlgorithm`
    set:

      tls:
        autoGenerated:
          certManager:
            keyAlgorithm: RSA
    asserts:
      - equal:
          path: spec.privateKey.algorithm
          value: RSA
  - it: should set `keySize`
    set:
      tls:
        autoGenerated:
          certManager:
            keySize: 2048
    asserts:
      - equal:
          path: spec.privateKey.size
          value: 2048
  - it: should set `duration`
    set:
      tls:
        autoGenerated:
          certManager:
            duration: 2160h
    asserts:
      - equal:
          path: spec.duration
          value: 2160h
  - it: should set `renewBefore`
    set:
      tls:
        autoGenerated:
          certManager:
            renewBefore: 360h
    asserts:
      - equal:
          path: spec.renewBefore
          value: 360h
